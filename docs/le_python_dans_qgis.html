
<!DOCTYPE HTML>
<html>
 <head>
  <meta charset="utf-8"/>
  <title>Python et QGIS</title>
  <link type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/github.min.css" rel="stylesheet"/>
  <link type="text/css" href="https://docs.3liz.org/remarkable.css" rel="stylesheet"/>
  <link type="image/png" href="logo.png" rel="icon" >
 </head>
 <body>
 <header class="header-container" style="">
    <h1>Python et QGIS</h1>
 </header>
 <article>
<div class="toc"><span class="toctitle">Table of content</span><ul>
<li><a href="#le-python-dans-qgis">Le python dans QGIS</a><ul>
<li><a href="#console">Console</a></li>
<li><a href="#script-python">Script Python</a></li>
<li><a href="#script-processing">Script Processing</a></li>
<li><a href="#un-modele-processing-en-python">Un modèle Processing en Python</a></li>
<li><a href="#extension-plugin">Extension (plugin)</a></li>
<li><a href="#fournisseur-processing-dans-une-extension-processing-provider">Fournisseur Processing dans une extension (Processing Provider)</a></li>
<li><a href="#expressions">Expressions</a></li>
<li><a href="#macros">Macros</a></li>
<li><a href="#actions">Actions</a></li>
<li><a href="#formulaire">Formulaire</a></li>
<li><a href="#applicationscript-independant">Application/script indépendant</a></li>
<li><a href="#le-fichier-startuppy">le fichier "startup.py"</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="le-python-dans-qgis">Le python dans QGIS</h1>
<p>QGIS permet d'utiliser du Python dans divers emplacement que nous allons voir ci-dessous.
Python possède de très nombreux packages/modules disponibles sur internet qui fournissent des fonctions déjà
écrites.</p>
<h2 id="console">Console</h2>
<p>La console est accessible par le menu <code>Extension</code> -&gt; <code>Console Python</code>. Elle permet l'écriture de commande
simple, une par une. 
On ne peut pas enregistrer les commandes dans un fichier.</p>
<h2 id="script-python">Script Python</h2>
<p>L'éditeur de script Python est accessible depuis l'icône dédiée dans la console Python.
Il permet un prototypage rapide d'un script. On peut y écrire du code plus complexe en faisant intervenir
des librairies ou des classes.</p>
<p><img alt="Console et éditeur de script" src="./media/console_editeur.png"></p>
<h2 id="script-processing">Script Processing</h2>
<p>Le menu Traitement dans QGIS donne accès a plusieurs algorithmes d'analyse. 
Ces algorithms proviennent soient de QGIS, GDAL ou encore de plugins.
La boîte à outils de traitements ainsi que le modeleur graphique utilisent le "framework" Processing propre à 
QGIS. Ce framework permet de définir les entrées et les sorties d'un algorithme. Les algorithms sont donc 
normalisés en suivant tous le même modèle. Processing impose la façon d'écrire les scripts.</p>
<p>Écrire un script <em>compatible</em> QGIS Processing permet l'intégration dans ce menu, permet également 
l'utilisation de ce-dernier dans un modèle ou encore l'utilisation en mode traitement par lot. Le framework
peut aussi générer automatiquement l'interface graphique de l'algorithme et le code est optimisé.</p>
<p>Il existe un modèle par défaut que l'on peut utiliser pour démarrer l'écriture d'un script Processing.
Depuis la barre d'outils traitements, <code>Créer un nouveau script depuis un modèle.</code> Ce modèle utilise la syntaxe
Programmation Orientée Objet. Depuis QGIS 3.6, on peut également utiliser la syntaxe par décorateur <code>@alg</code>.
Voir la documentation <a href="https://docs.qgis.org/testing/en/docs/user_manual/processing/scripts.html#the-alg-decorator">https://docs.qgis.org/testing/en/docs/user_manual/processing/scripts.html#the-alg-decorator</a></p>
<p><img alt="Script template" src="./media/script_template.png"></p>
<h2 id="un-modele-processing-en-python">Un modèle Processing en Python</h2>
<p>Depuis QGIS 3.6, on peut désormais exporter un modèle de traitement Processing en Python.
Il faut faire un clic droit sur un modèle dans la boîte à outils puis choisir "Exporter le modèle comme un 
algorithme Python".
On peut donc modifier ensuite ce fichier Python afin de rajouter de la logique supplémentaire.</p>
<p><img alt="Modèle Processing vers Python" src="./media/model_to_python.png"></p>
<h2 id="extension-plugin">Extension (plugin)</h2>
<ul>
<li>Extension côté bureautique et même côté QGIS Serveur.</li>
<li>La plupart des plugins sont disponibles sur <a href="https://plugins.qgis.org">https://plugins.qgis.org</a> pour le 
  téléchargement, 
ou sinon ils peuvent être installés par un dossier ZIP.</li>
<li>Afin de développer une extension :<ul>
<li>Utilisation du Plugin Builder</li>
<li>ou squelette minimum : <a href="https://github.com/wonder-sk/qgis-minimal-plugin">https://github.com/wonder-sk/qgis-minimal-plugin</a></li>
</ul>
</li>
<li>Plugin Reloader permet de simplifier le développement en évitant de recharger QGIS</li>
<li>Documentation plugin QGIS Serveur : <a href="https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/server.html">https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/server.html</a></li>
</ul>
<h2 id="fournisseur-processing-dans-une-extension-processing-provider">Fournisseur Processing dans une extension (Processing Provider)</h2>
<p>Similaire au script Processing, une extension QGIS peut aussi avoir son propre fournisseur d'algorithme.</p>
<p><img alt="Processing provider" src="./media/processing_provider.png"></p>
<p>On peut remarquer les plugins <code>DataPlotly</code>, <code>QuickOSM</code> etc.</p>
<p>Ajout de Processing à un plugin QGIS :
* soit lors du plugin builder
* ou manuellement en suivant la documentation pour l'ajout à un plugin existant :
  <a href="https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/processing.html">https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/processing.html</a> </p>
<p>Il se peut que certaines extensions ne soient <em>que</em> des fournisseurs Processing.</p>
<h2 id="expressions">Expressions</h2>
<p>Les expressions sont souvent présentes dans QGIS. On peut les utiliser dans nombreux endroits, pour faire des
sélections, des conditions, etc.
On peut également les utiliser à chaque fois que vous pouvez voir ce symbole :
<img alt="Data defined" src="./media/data_defined.png"></p>
<p>Un plugin, ou même simplement un utilisateur, peut enregistrer ses propres expressions. Ci-dessous, le plugin
<code>InaSAFE</code>:
<img alt="Plugin expression" src="./media/plugin_expression.png"></p>
<!-- ![Processing provider](./media/editeur_expression.png) -->

<p>Exemple de code d'une expression :</p>
<pre><code class="python">@qgsfunction(args='auto', group='Custom')
def my_sum(value1, value2, feature, parent):
    &quot;&quot;&quot;
    Calculates the sum of the two parameters value1 and value2.
    &lt;h2&gt;Example usage:&lt;/h2&gt;
    &lt;ul&gt;
      &lt;li&gt;my_sum(5, 8) -&gt; 13&lt;/li&gt;
      &lt;li&gt;my_sum(&quot;field1&quot;, &quot;field2&quot;) -&gt; 42&lt;/li&gt;
    &lt;/ul&gt;
    &quot;&quot;&quot;
    return value1 + value2
</code></pre>

<h2 id="macros">Macros</h2>
<p>Accessible depuis les propriétés du projet, dans l'onglet <code>Macros</code>. On peut lancer du code Python 
automatiquement soit :
* à l'ouverture du projet
* lors de l'enregistrement du projet
* ou lors de sa fermeture </p>
<p><img alt="Project macro" src="./media/macros.png"></p>
<h2 id="actions">Actions</h2>
<p>Les actions sont des petits traitements que l'on peut lancer soit depuis la table attributaire ou depuis le
canevas.
Par exemple, on peut ouvrir un lien WEB ou un PDF en fonction d'un attribut d'une entité. Il est possible 
d'écrire les actions en Python.</p>
<p><img alt="Action sur une couche" src="./media/action.png"></p>
<h2 id="formulaire">Formulaire</h2>
<p>On peut personnaliser un formulaire par l'ajout de logique Python. Cependant, dans QGIS 3, 
l'utilisation de Python n'est plus forcément nécessaire, on peut désormais utiliser des expressions 
<strong>(recommandé)</strong>.</p>
<p><img alt="Formulaire avec logique Python" src="./media/formulaire_python.png"></p>
<h2 id="applicationscript-independant">Application/script indépendant</h2>
<p>Sans lancer QGIS graphiquement, on peut utiliser la librairie QGIS dans nos scripts Python. On peut donc créer
notre propre application graphique ou notre propre exécutable et ainsi utiliser les fonctions de QGIS.
On peut donc faire un programme en ligne de commande qui effectue une certaine opération dans un répertoire
donné.</p>
<h2 id="le-fichier-startuppy">le fichier "<a href="http://startup.py">startup.py</a>"</h2>
<p>Si l'on place un fichier nommé <code>startup.py</code> dans le dossier Python du profil de l'utilisateur, QGIS va le
lancer automatiquement à chaque ouverture de QGIS.</p>
<p><a href="./readme.html">Retour</a></p>
  </article>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js">
  </script>
  <script>
   hljs.initHighlightingOnLoad();
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
  </script>
  <script type="text/javascript">
   MathJax.Hub.Config({"showProcessingMessages" : false,"messageStyle" : "none","tex2jax": { inlineMath: [ [ "$", "$" ] ] }});
  </script>
 </body>
</html>
