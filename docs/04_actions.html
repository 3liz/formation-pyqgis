
<!DOCTYPE HTML>
<html>
 <head>
  <meta charset="utf-8"/>
  <title>Actions</title>
  <link type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/github.min.css" rel="stylesheet"/>
  <link type="text/css" href="https://docs.3liz.org/remarkable.css" rel="stylesheet"/>
  <link type="image/png" href="logo.png" rel="icon" >
 </head>
 <body>
 <header class="header-container" style="">
    <h1>Actions</h1>
 </header>
 <article>
<div class="toc"><span class="toctitle">Table of content</span><ul>
<li><a href="#les-actions">Les actions</a><ul>
<li><a href="#les-actions-par-defaut">Les actions par défaut</a></li>
<li><a href="#notre-propre-action">Notre propre action</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="les-actions">Les actions</h1>
<ul>
<li>Pour connaître le principe des actions dans QGIS, il faut se référer au manuel de QGIS :<ul>
<li><a href="https://docs.qgis.org/3.4/fr/docs/user_manual/working_with_vector/vector_properties.html#actions-properties">https://docs.qgis.org/3.4/fr/docs/user_manual/working_with_vector/vector_properties.html#actions-properties</a></li>
</ul>
</li>
<li>Ajouter la couche <code>D_OSM_HYDROGRAPHIE/CANALISATION_EAU.shp</code>.</li>
<li>Faire un style rapide pour mettre en évidence le sens de la ligne à l'aide d'une <code>Ligne de symbole</code> dans
  l'onglet <code>Symbologie</code>.</li>
</ul>
<h2 id="les-actions-par-defaut">Les actions par défaut</h2>
<ul>
<li>Dans la fenêtre des propriétés d'une couche vecteur, aller dans l'onglet <code>Actions</code>.</li>
<li>Cliquer sur le bouton <code>Créer les actions par défaut</code>.</li>
<li>Observons quelques actions pour comprendre le fonctionnement.</li>
</ul>
<h2 id="notre-propre-action">Notre propre action</h2>
<ul>
<li>Commençons par un script Python classique, laissons de côté les actions pour le moment.</li>
<li>Écrire une fonction qui se charge <em>d'inverser</em> une ligne. Cette fonction prend en paramètre la couche
  vecteur et une liste d'ID des entités.</li>
<li>Il faut penser à vérifier le type exact de géométrie de nos lignes, dans les propriétés de la couche.</li>
</ul>
<pre><code class="python">def reverse_geom(layer, ids):
    &quot;&quot;&quot;Inverser le sens des différentes entités dans la couche layer.

    ids est une liste comportant les IDs des entités à inverser.
    &quot;&quot;&quot;
    pass

</code></pre>

<ul>
<li>Solution :</li>
</ul>
<pre><code class="python">def reverse_geom(layer, ids):
    &quot;&quot;&quot;Inverser le sens des différentes entités dans la couche layer.

    ids est une liste comportant les IDs des entités à inverser.
    &quot;&quot;&quot;
    with edit(layer):
        for feature in layer.getFeatures(ids):
           geom = feature.geometry()
           lines = geom.asMultiPolyline()
           for line in lines:
               line.reverse() 
           newgeom = QgsGeometry.fromMultiPolylineXY(lines)
           layer.changeGeometry(feature.id(),newgeom)

layer = iface.activeLayer()
ids = layer.selectedFeatureIds()

reverse_geom(layer, ids)
</code></pre>

<p>Incorporons ce code dans une action et adaptons le un peu :</p>
<p><img alt="Inverser canalisation" src="./media/action_inverser_ligne.png"></p>
<pre><code class="python">def reverse_geom(layer, ids):
    with edit(layer):
        for feature in layer.getFeatures(ids):
           geom = feature.geometry()
           lines = geom.asMultiPolyline()
           for line in lines:
               line.reverse() 
           new_geom = QgsGeometry.fromMultiPolylineXY(lines)
           layer.changeGeometry(feature.id(), new_geom)

layer = QgsProject.instance().mapLayer('[% @layer_id %]')
reverse_geom(layer, '[% $id%]')
</code></pre>

<p>On peut désormais cliquer sur une ligne pour automatiquement inverser une ligne.</p>
<p><a href="./readme.html">Retour</a></p>
  </article>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js">
  </script>
  <script>
   hljs.initHighlightingOnLoad();
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
  </script>
  <script type="text/javascript">
   MathJax.Hub.Config({"showProcessingMessages" : false,"messageStyle" : "none","tex2jax": { inlineMath: [ [ "$", "$" ] ] }});
  </script>
 </body>
</html>
