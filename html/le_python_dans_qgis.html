<!DOCTYPE HTML>
<html>
 <head>
  <meta charset="utf-8"/>
  <title>
   Le-Python-Dans-QGIS
  </title>
  <link href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/github.min.css" rel="stylesheet"/>
  <style type="text/css">
   body,table tr{background-color:#fff}table tr td,table tr th{border:1px solid #ccc;text-align:left;padding:6px 13px;margin:0}pre code,table,table tr{padding:0}hr,pre code{background:0 0}body{font:16px Helvetica,Arial,sans-serif;line-height:1.4;color:#333;word-wrap:break-word;padding:10px 15px}strong,table tr th{font-weight:700}h1{font-size:2em;margin:.67em 0;text-align:center}h2{font-size:1.75em}h3{font-size:1.5em}h4{font-size:1.25em}h1,h2,h3,h4,h5,h6{font-weight:700;position:relative;margin-top:15px;margin-bottom:15px;line-height:1.1}h1,h2{border-bottom:1px solid #eee}hr{height:0;margin:15px 0;overflow:hidden;border:0;border-bottom:1px solid #ddd}a{color:#4183C4}a.absent{color:#c00}ol,ul{padding-left:15px;margin-left:5px}ol{list-style-type:lower-roman}table tr{border-top:1px solid #ccc;margin:0}table tr:nth-child(2n){background-color:#aaa}table tr td :first-child,table tr th :first-child{margin-top:0}table tr td:last-child,table tr th :last-child{margin-bottom:0}img{max-width:100%}blockquote{padding:0 15px;border-left:4px solid #ccc}code,tt{margin:0 2px;padding:0 5px;white-space:nowrap;border:1px solid #eaeaea;background-color:#f8f8f8;border-radius:3px}pre code{margin:0;white-space:pre;border:none}.highlight pre,pre{background-color:#f8f8f8;border:1px solid #ccc;font-size:13px;line-height:19px;overflow:auto;padding:6px 10px;border-radius:3px}
  </style>
 </head>
 <body>
  <h1>
   Le python dans QGIS
  </h1>
  <p>
   QGIS permet d'utiliser du Python dans divers emplacement que nous allons voir ci-dessous.
   <br/>
   Python possède de très nombreux packages/modules disponibles sur internet qui fournissent des fonctions déjà écrites.
  </p>
  <h2>
   Console
  </h2>
  <p>
   La console est accessible par le menu
   <code>
    Extension
   </code>
   -&gt;
   <code>
    Console Python
   </code>
   . Elle permet l'écriture de commande simple, une par une.
   <br/>
   On ne peut pas enregistrer les commandes dans un fichier.
  </p>
  <h2>
   Script Python
  </h2>
  <p>
   L'éditeur de script Python est accessible depuis l'icône dédié dans la console Python.
   <br/>
   Il permet un prototypage rapide d'un script. On peut y écrire du code plus complexe en faisant intervenir
   <br/>
   des librairies ou des classes.
  </p>
  <p>
   <img alt="Console et éditeur de script" src="./media/console_editeur.png"/>
  </p>
  <h2>
   Script Processing
  </h2>
  <p>
   Le menu Traitement dans QGIS donne accès a plusieurs algorithmes d'analyse.
   <br/>
   Ces algorithms proviennent soient de QGIS, GDAL ou encore de plugins.
   <br/>
   La boîte à outils de traitements ainsi que le modeleur graphique utilisent le "framework" Processing propre à QGIS.
   <br/>
   Ce framework permet de définir les entrées et les sorties d'un algorithme. Les algorithms sont donc normalisés en
   <br/>
   suivant tous le même modèle. Processing impose la façon d'écrire les scripts.
  </p>
  <p>
   Écrire un script
   <em>
    compatible
   </em>
   QGIS Processing permet l'intégration dans ce menu, permet également l'utilisation de ce-dernier
   <br/>
   dans un modèle ou encore l'utilisation en mode traitement par lot. Le framework peut aussi générer automatiquement
   <br/>
   l'interface graphique de l'algorithme et le code est optimisé.
  </p>
  <p>
   Il existe un modèle par défaut que l'on peut utiliser pour démarrer l'écriture d'un script Processing.
   <br/>
   Depuis la barre d'outil traitements,
   <code>
    Créer un nouveau script depuis un modèle.
   </code>
   Ce modèle utilise la syntaxe Programmation
   <br/>
   Orientée Objet. Depuis QGIS 3.6, on peut également utiliser la syntaxe par décorateur
   <code>
    @alg
   </code>
   .
   <br/>
   Voir la documentation https://docs.qgis.org/testing/en/docs/user_manual/processing/scripts.html#the-alg-decorator
  </p>
  <p>
   <img alt="Script template" src="./media/script_template.png"/>
  </p>
  <h2>
   Un modèle Processing en Python
  </h2>
  <p>
   Depuis QGIS 3.6, on peut désormais exporter un modèle de traitement Processing en Python.
   <br/>
   Il faut faire un clic droit sur un modèle dans la boîte à outils puis choisir "Exporter le modèle comme un algorithme Python".
   <br/>
   On peut donc modifier ensuite ce fichier Python afin de rajouter de la logique suplémentaire.
  </p>
  <p>
   <img alt="Modèle Processing vers Python" src="./media/model_to_python.png"/>
  </p>
  <h2>
   Extension (plugin)
  </h2>
  <ul>
   <li>
    Extension côté bureautique et même côté QGIS Serveur.
   </li>
   <li>
    La plupart des plugins sont disponibles sur
    <a href="https://plugins.qgis.org">
     https://plugins.qgis.org
    </a>
    pour le téléchargement,
    <br/>
    ou sinon ils peuvent être installés par un dosssier ZIP.
   </li>
   <li>
    Afin de développer un plugin:
    <ul>
     <li>
      Utilisation du Plugin Builder
     </li>
     <li>
      ou squelette minimum : https://github.com/wonder-sk/qgis-minimal-plugin
     </li>
    </ul>
   </li>
   <li>
    Plugin Reloader permet de simplifier le développement en évitant de recharger QGIS
   </li>
   <li>
    Documentation plugin QGIS Serveur : https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/server.html
   </li>
  </ul>
  <h2>
   Fournisseur Processing dans une extension (Processing Provider)
  </h2>
  <p>
   Similaire au script Processing, une extension QGIS peut aussi avoir son propre fournisseur d'algorithme.
  </p>
  <p>
   <img alt="Processing provider" src="./media/processing_provider.png"/>
  </p>
  <p>
   On peut remarquer les plugins
   <code>
    DataPlotly
   </code>
   ,
   <code>
    QuickOSM
   </code>
   etc.
  </p>
  <p>
   Ajout de Processing à un plugin QGIS :
   <br/>
   <em>
    soit lors du plugin builder
    <br/>
   </em>
   ou manuellement en suivant la documentation pour l'ajout à un plugin existant: https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/processing.html
  </p>
  <p>
   Il se peut que certaines extensions ne soient
   <em>
    que
   </em>
   des fournisseurs Processing.
  </p>
  <h2>
   Expressions
  </h2>
  <p>
   Les expressions sont souvent présentes dans QGIS. On peut les utiliser dans nombreux endroits, pour faire des sélection, des conditions etc.
   <br/>
   On peut également les utiliser à chaque fois que vous pouvez voir ce symbole:
   <br/>
   <img alt="Data defined" src="./media/data_defined.png"/>
  </p>
  <p>
   Un plugin, ou même simplement un utilisateur, peut enregistrer ses propres expressions. Ci-dessous, le plugin
   <code>
    InaSAFE
   </code>
   :
   <br/>
   <img alt="Plugin expression" src="./media/plugin_expression.png"/>
  </p>
  <p>
   <img alt="Processing provider" src="./media/editeur_expression.png"/>
  </p>
  <p>
   Exemple de code d'une expression:
  </p>
  <pre><code class="python">@qgsfunction(args='auto', group='Custom')
def my_sum(value1, value2, feature, parent):
    """
    Calculates the sum of the two parameters value1 and value2.
    &lt;h2&gt;Example usage:&lt;/h2&gt;
    &lt;ul&gt;
      &lt;li&gt;my_sum(5, 8) -&gt; 13&lt;/li&gt;
      &lt;li&gt;my_sum("field1", "field2") -&gt; 42&lt;/li&gt;
    &lt;/ul&gt;
    """
    return value1 + value2
</code></pre>
  <h2>
   Macros
  </h2>
  <p>
   Accessible depuis les propriétés du projet, dans l'onglet
   <code>
    Macros
   </code>
   . On peut lancer du code Python automatiquement soit:
   <br/>
   <em>
    à l'ouverture du projet
    <br/>
   </em>
   lors de l'enregistrement du projet
   <br/>
   * ou lors de sa fermeture
  </p>
  <p>
   <img alt="Project macro" src="./media/macros.png"/>
  </p>
  <h2>
   Actions
  </h2>
  <p>
   Les actions sont des petits traitements que l'on peut lancer soit depuis la table attributaire ou depuis le canevas.
   <br/>
   Par exemple, on peut ouvrir un lien WEB ou un PDF en fonction d'un attribut d'une entité. Il est possible
   <br/>
   d'écrire les actions en Python.
  </p>
  <p>
   <img alt="Action sur une couche" src="./media/action.png"/>
  </p>
  <h2>
   Formulaire
  </h2>
  <p>
   On peut personnaliser un formulaire par l'ajout de logique Python. Cependant, dans QGIS 3,
   <br/>
   l'utilisation de Python n'est plus forcément nécessaire, on peut désormais utiliser des expressions
   <strong>
    (recommandé)
   </strong>
   .
  </p>
  <p>
   <img alt="Formulaire avec logique Python" src="./media/formulaire_python.png"/>
  </p>
  <h2>
   Application/script indépendant
  </h2>
  <p>
   Sans lancer QGIS graphiquement, on peut utiliser la librairie QGIS dans nos scripts Python. On peut donc créer notre propre
   <br/>
   application graphique ou notre propre exécutable et ainsi utiliser les fonctions de QGIS.
   <br/>
   On peut donc faire un programme en ligne de commande qui effectue une certaine opération dans un répertoire donné.
  </p>
  <h2>
   le fichier "startup.py"
  </h2>
  <p>
   Si l'on place un fichier nommé
   <code>
    startup.py
   </code>
   dans le dossier Python du profil de l'utilisateur, QGIS va le lancer
   <br/>
   automatiquement à chaque ouverture de QGIS.
  </p>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js">
  </script>
  <script>
   hljs.initHighlightingOnLoad();
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
  </script>
  <script type="text/javascript">
   MathJax.Hub.Config({"showProcessingMessages" : false,"messageStyle" : "none","tex2jax": { inlineMath: [ [ "$", "$" ] ] }});
  </script>
 </body>
</html>